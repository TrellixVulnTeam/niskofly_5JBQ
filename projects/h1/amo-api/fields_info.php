<?php$need=array_flip(array('POSITION','PHONE','EMAIL'));if(isset($account['custom_fields'],$account['custom_fields']['contacts']))	do	{		foreach($account['custom_fields']['contacts'] as $field)			if(is_array($field) && isset($field['id']))			{				if(isset($field['code']) && isset($need[$field['code']]))					$fields[$field['code']]=(int)$field['id'];				//COUNTRY - нестандартное поле, поэтому обрабатываем его отдельно				/*elseif(isset($field['name']) && $field['name']=='Страна')					$fields['COUNTRY']=$field;*/				$diff=array_diff_key($need,$fields);				if(empty($diff))					break 2;			}			if(isset($diff))				die('В amoCRM отсутствуют следующие поля  в контактах'.': '.join(', ',$diff));			else				die('Невозможно получить дополнительные поля');		}	while(false);else	die('Невозможно получить дополнительные поля');$custom_fields=isset($fields) ? $fields : false;$fields=array();$need=array_flip(array('MESSAGE','COURSE','PROMOCODE'));if(isset($account['custom_fields'],$account['custom_fields']['leads']))    do    {        foreach($account['custom_fields']['leads'] as $field)            if(is_array($field) && isset($field['id']))            {				if(isset($field['name']) && $field['name']=='Message'){                    $fields['MESSAGE']=(int)$field['id'];}                elseif(isset($field['name']) && $field['name']=='Course'){                    $fields['COURSE']=(int)$field['id'];}                elseif(isset($field['name']) && $field['name']=='Promocode'){                    $fields['PROMOCODE']=(int)$field['id'];}                $diff=array_diff_key($need,$fields);                if(empty($diff))                    break 2;            }        if(isset($diff))            die('В amoCRM отсутствуют следующие поля'.': '.join(', ',$diff));        else            die('Невозможно получить дополнительные поля');    }    while(false);else    die('Невозможно получить дополнительные поля');$custom_fields_leads=isset($fields) ? $fields : false;//die(var_dump($custom_fields_leads));/*$custom_fields_leads=isset($fields) ? $fields : false;*/?>